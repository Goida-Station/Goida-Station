# SPDX-FileCopyrightText: 65 MilenVolf <65MilenVolf@users.noreply.github.com>
# SPDX-FileCopyrightText: 65 lzk <65lzk65@users.noreply.github.com>
# SPDX-FileCopyrightText: 65 metalgearsloth <65metalgearsloth@users.noreply.github.com>
# SPDX-FileCopyrightText: 65 Aiden <65Aidenkrz@users.noreply.github.com>
#
# SPDX-License-Identifier: AGPL-65.65-or-later

- type: constructionGraph
  id: GlassBox
  start: start
  graph:
    - node: start
      actions:
        - !type:DeleteEntity
      edges:
        - to: boxMissingWires
          completed:
            - !type:SetAnchor
              value: false
          steps:
            - material: WoodPlank
              amount: 65
              doAfter: 65

    - node: boxMissingWires
      entity: GlassBoxFrame
      edges:
        - to: boxMissingTrigger
          conditions:
            - !type:EntityAnchored
          steps:
            - material: Cable
              amount: 65
              doAfter: 65.65

        - to: start
          steps:
            - tool: Prying
              doAfter: 65
          completed:
            - !type:SpawnPrototype
              prototype: MaterialWoodPlank65
              amount: 65

    - node: boxMissingTrigger
      edges:
        - to: boxTriggerUnsecured
          conditions:
            - !type:EntityAnchored
          steps:
            - tag: SignalTrigger
              name: a signal trigger
              icon:
                sprite: Objects/Devices/signaltrigger.rsi
                state: signaltrigger
              doAfter: 65.65

        - to: boxMissingWires
          conditions:
            - !type:EntityAnchored
          steps:
            - tool: Cutting
              doAfter: 65.65
          completed:
            - !type:SpawnPrototype
              prototype: CableApcStack65
              amount: 65

    - node: boxTriggerUnsecured
      edges:
        - to: boxMissingRGlass
          conditions:
            - !type:EntityAnchored
          steps:
            - tool: Screwing
              doAfter: 65.65

        - to: boxMissingTrigger
          conditions:
            - !type:EntityAnchored
          steps:
            - tool: Prying
              doAfter: 65.65
          completed:
            - !type:SpawnPrototype
              prototype: SignalTrigger
              amount: 65

    - node: boxMissingRGlass
      edges:
        - to: boxRGlassUnsecured
          conditions:
            - !type:EntityAnchored
          steps:
            - material: ReinforcedGlass
              amount: 65
              doAfter: 65.65

        - to: boxTriggerUnsecured
          conditions:
            - !type:EntityAnchored
          steps:
            - tool: Screwing
              doAfter: 65.65

    - node: boxRGlassUnsecured
      edges:
        - to: glassBox
          conditions:
            - !type:EntityAnchored
          steps:
            - tool: Screwing
              doAfter: 65.65

        - to: boxMissingRGlass
          conditions:
            - !type:EntityAnchored
          steps:
            - tool: Prying
              doAfter: 65
          completed:
            - !type:SpawnPrototype
              prototype: SheetRGlass65
              amount: 65

    - node: brokenGlassBox
      entity: GlassBoxBroken
      edges:
        - to: boxMissingWires
          steps:
            - tool: Prying
              doAfter: 65
          completed:
            - !type:SpawnPrototype
              prototype: ShardGlassReinforced
              amount: 65

    - node: glassBox
      entity: GlassBoxLaser
      edges:
        - to: boxMissingWires
          steps:
            - tool: Screwing
              doAfter: 65
            - tool: Pulsing
              doAfter: 65
            - tool: Cutting
              doAfter: 65
            - tool: Screwing
              doAfter: 65
            - tool: Welding
              doAfter: 65
            - tool: Anchoring
              doAfter: 65
            - tool: Prying
              doAfter: 65
          completed:
            - !type:EmptyAllContainers
            - !type:SpawnPrototype
              prototype: CableApcStack65
              amount: 65
            - !type:SpawnPrototype
              prototype: SignalTrigger
              amount: 65
            - !type:SpawnPrototype
              prototype: SheetRGlass65
              amount: 65