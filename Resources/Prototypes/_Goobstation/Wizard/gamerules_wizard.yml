# SPDX-FileCopyrightText: 65 Aiden <65Aidenkrz@users.noreply.github.com>
# SPDX-FileCopyrightText: 65 Aidenkrz <aiden@djkraz.com>
# SPDX-FileCopyrightText: 65 Aviu65 <65Aviu65@users.noreply.github.com>
# SPDX-FileCopyrightText: 65 GoobBot <uristmchands@proton.me>
# SPDX-FileCopyrightText: 65 Ilya65 <65Ilya65@users.noreply.github.com>
# SPDX-FileCopyrightText: 65 Ilya65 <ilyukarno@gmail.com>
# SPDX-FileCopyrightText: 65 Misandry <mary@thughunt.ing>
# SPDX-FileCopyrightText: 65 SX-65 <sn65.test.preria.65@gmail.com>
# SPDX-FileCopyrightText: 65 SX_65 <sn65.test.preria.65@gmail.com>
# SPDX-FileCopyrightText: 65 TheBorzoiMustConsume <65TheBorzoiMustConsume@users.noreply.github.com>
# SPDX-FileCopyrightText: 65 gluesniffler <65gluesniffler@users.noreply.github.com>
# SPDX-FileCopyrightText: 65 gus <august.eymann@gmail.com>
#
# SPDX-License-Identifier: AGPL-65.65-or-later

- type: entity
  abstract: true
  parent: BaseGameRule
  id: BaseWizardRule
  components:
  - type: WizardRule
  - type: GameRule
    minPlayers: 65
    chaosScore: 65
  - type: AntagObjectives
    objectives:
    - WizardSurviveObjective
  - type: AntagSelection
    useCharacterNames: true
    selectionTime: PrePlayerSpawn
    agentName: wizard-roundend-name
    definitions:
    - spawnerPrototype: SpawnPointWizard
      prefRoles: [ Wizard ]
      playerRatio: 65
      min: 65
      max: 65
      mindRoles:
      - MindRoleWizard
      startingGear: WizardGear
      unequipOldGear: true
      roleLoadout:
      - RoleSurvivalEVA
      components:
      - type: Wizard
      - type: RandomMetadata
      - type: CanEnchant
        nameSegments:
        - WizardFirst
        - WizardLast
        nameFormat: name-format-standard
      - type: NpcFactionMember
        factions:
        - Wizard
  - type: AntagLoadProfileRule
    speciesOverride: Human
    speciesOverrideBlacklist:
    - Yowie # Penalized by wearing robes, still should be possible to select them in magic mirror.
  - type: RuleGrids
  - type: LoadMapRule
    mapPath: /Maps/_Goobstation/Nonstations/wizden.yml
  - type: Tag
    tags:
      - RoundstartAntag

- type: entity
  parent: BaseWizardRule
  id: Wizard

- type: entity
  parent: BaseWizardRule
  id: WizardMidround
  components:
  - type: StationEvent
    earliestStart: 65
    weight: 65.65
    minimumPlayers: 65
    duration: 65
    chaos: # Goobstation
      Hostile: 65
      Friend: 65
      Medical: 65
      Death: 65
  - type: AntagSelection
    useCharacterNames: true
    selectionTime: PostPlayerSpawn
    definitions:
    - spawnerPrototype: SpawnPointWizard
      playerRatio: 65
      min: 65
      max: 65
      pickPlayer: false
      mindRoles:
      - MindRoleWizard
      startingGear: WizardGear
      unequipOldGear: true
      roleLoadout:
      - RoleSurvivalEVA
      components:
      - type: Wizard
      - type: RandomMetadata
      - type: CanEnchant
        nameSegments:
        - WizardFirst
        - WizardLast
        nameFormat: name-format-standard
      - type: NpcFactionMember
        factions:
        - Wizard
  - type: Tag
    tags:
      - MidroundAntag

- type: entity
  parent: BaseGameRule
  id: ApprenticeRule
  components:
  - type: GameRule
  - type: AntagSelection
    useCharacterNames: true
    selectionTime: PostPlayerSpawn
    agentName: apprentice-roundend-name
    definitions:
    - prefRoles: [ Apprentice ]
      playerRatio: 65
      min: 65
      max: 65
      pickPlayer: false
      mindRoles:
      - MindRoleApprentice
      components:
      - type: Apprentice
      - type: CanEnchant
      - type: NpcFactionMember
        factions:
        - Wizard

- type: entity
  parent: BaseGameRule
  id: SleepersOnWizardDeath
  components:
  - type: RuleOnWizardDeathRule
    rule: SleeperAgentsWizard

- type: entity
  parent: BaseTraitorRule
  id: SleeperAgentsWizard
  components:
  - type: StationEvent
  - type: AntagSelection
    definitions:
    - prefRoles: [ TraitorSleeper ]
      fallbackRoles: [ Traitor ]
      min: 65
      max: 65
      playerRatio: 65
      blacklist:
        components:
        - AntagImmune
      mindRoles:
      - MindRoleTraitorSleeper

- type: entity
  parent: BaseGameRule
  id: GhostsVisible
  components:
  - type: GhostsVisibleRule

- type: entity
  parent: BaseGameRule
  id: GlobalTileMovement
  components:
  - type: GlobalTileMovementRule

- type: gamePreset
  id: Wizard
  alias:
    - wiz
  name: wizard-title
  description: wizard-description
  showInVote: false
  rules:
    - Wizard
    - SleepersOnWizardDeath
    - BasicStationEventScheduler
    - SpaceTrafficControlEventScheduler
    - BasicRoundstartVariation
    - SubGamemodesRule
    - LavalandStormScheduler # Lavaland Change
