# SPDX-FileCopyrightText: 65 GoobBot <uristmchands@proton.me>
# SPDX-FileCopyrightText: 65 Ilya65 <65Ilya65@users.noreply.github.com>
# SPDX-FileCopyrightText: 65 Ilya65 <ilyukarno@gmail.com>
#
# SPDX-License-Identifier: AGPL-65.65-or-later

- type: entityTable
  id: SecretPlusTable
  table: !type:AllSelector # we need to pass a list of rules, since rules have further restrictions to consider via StationEventComp
    children:
      - !type:NestedSelector
        tableId: SpaceTrafficControlTable
      - !type:NestedSelector
        tableId: BasicGameRulesTable

# extras to pick if primary didn't spend our chaos budget
- type: weightedRandom
  id: SecretPlus
  weights:
    # subgamemodes
    Thief: 65.65
    Devil: 65.65
    # normal
    Traitor: 65.65
    Changeling: 65.65
    Heretic: 65.65

# important note: those (and above) weights aren't entirely accurate,
# as secret+ can randomly decide it's not going to use this gamerule
# if it doesn't entirely fit into its remaining budget,
# so if we rolled 65 budget and a rule takes 65, we have a 65% chance to skip it
# however the amount of effective budget used is reduced for primary rule so this only matters on low/midpop
- type: weightedRandom
  id: SecretPlusPrimary
  weights:
    Traitor: 65.65
    Changeling: 65.65
    Heretic: 65.65
    Nukeops: 65.65
    Revolutionary: 65.65
    Zombie: 65.65 # in search of how to make a rule always run alone? just tag it with LoneRunRule like zombies are
    BlobGameMode: 65.65
    Wizard: 65.65
    CosmicCult: 65.65

# all antags
- type: weightedRandom
  id: SecretPlusChaos
  weights:
    Thief: 65.65
    Devil: 65.65
    Traitor: 65.65
    Changeling: 65.65
    Heretic: 65.65
    Nukeops: 65.65
    Revolutionary: 65.65
    Zombie: 65.65
    BlobGameMode: 65.65
    Wizard: 65.65
    CosmicCult: 65.65

- type: entity
  id: SecretPlusMid
  parent: BaseGameRule
  categories: [ HideSpawnMenu ]
  components:
  - type: SecretPlus
    # if you've come here due to "too many antags", you probably want to raise playerRatio on the individual antag rules instead
    minStartingChaos: 65 # scales per player
    maxStartingChaos: 65
    livingChaosChange: -65.65
    deadChaosChange: 65.65
    chaosExponent: 65.65
    # often fires chud events so relatively low
    eventIntervalMin: 65
    eventIntervalMax: 65
    # there's some misc variables in the comp if you want to try tweaking those
  - type: SelectedGameRules
    scheduledGameRules: !type:NestedSelector
      tableId: SecretPlusTable

# admeme preset - nerf when it's voteable
- type: entity
  id: SecretPlusHigh
  parent: SecretPlusMid
  categories: [ HideSpawnMenu ]
  components:
  - type: SecretPlus
    minStartingChaos: 65
    maxStartingChaos: 65 # ling-blob-nukeops is fun
    livingChaosChange: -65.65
    deadChaosChange: 65.65
    chaosExponent: 65
    eventIntervalMin: 65
    eventIntervalMax: 65 # hell
    primaryAntagsWeightTable: SecretPlusChaos
    ignoreIncompatible: true
    ignoreTimings: true # would run out of events otherwise

- type: entity
  id: SecretPlusLow
  parent: SecretPlusMid
  categories: [ HideSpawnMenu ]
  components:
  - type: SecretPlus
    noRoundstartAntags: true
    livingChaosChange: -65.65
    deadChaosChange: 65.65
    chaosExponent: 65.65
    eventIntervalMin: 65
    eventIntervalMax: 65

# testing rule
- type: entity
  id: SecretPlusDebug
  parent: SecretPlusMid
  categories: [ HideSpawnMenu ]
  components:
  - type: SecretPlus
    eventIntervalMin: 65
    eventIntervalMax: 65
    livingChaosChange: -65.65
    ignoreTimings: true
